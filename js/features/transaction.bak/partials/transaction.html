<div class="sandBox_content" ng-if="pageType == 'list'">
    <div class="tra-content">
        <div class="space-bot" style="margin-top: 0px;">
            <div class="space-b-head">
                <div class="b-box" ng-click="switchTab('space')" ng-class="{on: tabType === 'space'}" ng-if="currentAdmin.permissionMap[PERMISSION_SPACE_KEY]">
                    <div class="b-name">空间订单
                        <div class="b-line"></div>
                    </div>
                </div>
                <div class="b-box" ng-click="switchTab('agreement')" ng-class="{on: tabType === 'agreement'}" ng-if="currentAdmin.permissionMap[PERMISSION_LEASES_KEY]">
                    <div class="b-name">长租合同
                        <div class="b-line"></div>
                    </div>
                </div>
                <div class="b-box" ng-click="switchTab('longrent')" ng-class="{on: tabType === 'longrent'}" ng-if="currentAdmin.permissionMap[PERMISSION_APPOINTMENT_KEY]">
                    <div class="b-name">长租申请
                        <div class="b-line"></div>
                    </div>
                </div>
                <div class="b-box" ng-click="switchTab('event')" ng-class="{on: tabType === 'event'}" ng-if="currentAdmin.permissionMap[PERMISSION_EVENT_KEY]">
                    <div class="b-name">活动订单
                        <div class="b-line"></div>
                    </div>
                </div>
                <div class="b-box" ng-click="switchTab('member')" ng-class="{on: tabType === 'member'}">
                    <div class="b-name">会员卡
                        <div class="b-line"></div>
                    </div>
                </div>
                <div class="head-right">
                    <div class="head-r-item" ng-if="currentAdmin.permissionMap[PERMISSION_LEASES_KEY]">
                        <span class="n-icon ic-draft"></span>
                        <span class="link-txt" ng-click="seeDrafts()">合同草稿箱</span><span class="grey-f">({{draftCounts}})</span>
                    </div>
                    <div class="head-r-item" ng-if="tabType === 'event' || tabType === 'space' || tabType === 'agreement' || tabType === 'member'">
                        <span class="n-icon ic-download"></span>
                        <span class="link-txt" ng-click="exportExcel()">导出Excel</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="t-f-box">
            <div class="t-f-line" ng-if="roomTypes.length > 0">
                <div class="t-f-left">
                    空间类型
                </div>
                <div class="t-f-right">
                    <div class="t-f-op" ng-repeat="type in roomTypes" ng-bind="type.description" ng-if="tabType === 'longrent' || tabType === 'agreement'" ng-class="{off: type.name !== 'longterm', on: type.selected}"></div>
                    <div class="t-f-op" ng-click="selectSpaceType(type, roomTypes)" ng-repeat="type in roomTypes" ng-bind="type.description" ng-if="tabType !== 'longrent' && tabType !== 'agreement'" ng-class="{off: type.name === 'longterm', on: type.selected}"></div>
                </div>
            </div>
            <div class="t-f-line" ng-if="channelList.length > 0">
                <div class="t-f-left">
                    支付渠道
                </div>
                <div class="t-f-right">
                    <div class="t-f-op" ng-click="selectPayType(channel, channelList)" ng-repeat="channel in channelList" ng-bind="channel.payment.name" ng-class="{on: channel.selected}"></div>
                </div>
            </div>
            <div class="t-f-line">
                <div class="t-f-left">
                    关键字
                </div>
                <div class="t-f-right">
                    <div class="t-f-half t-f-s">
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.keyword" placeholder="placeholder.all" options="keywordList" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="ib-box" ng-if="filterOption.keyword">
                            <input type="text" class="t-f-input" ng-model="filterOption.keyword_search" ng-keyup="$event.keyCode === 13 && searchList()">
                        </div>
                    </div>
                    <div class="t-f-half t-f-b" ng-if="tabType!=='event'">
                        <span class="t-f-left small">社区</span>
                        <div class="t-four">
                            <sb-dropdown select="filterOption.buildingObj" placeholder="placeholder.all" options="buildings" flexible="true" no-empty></sb-dropdown>
                        </div>
                    </div>
                </div>
            </div>
            <div class="t-f-line" ng-if="tabType !== 'longrent' && tabType !== 'agreement' && tabType !== 'event'">
                <div class="t-f-left">
                    交易时间
                </div>
                <div class="t-f-right">
                    <div class="t-f-half t-f-s">
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.exchangeHour" placeholder="placeholder.all" options="filterExchangeHour" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_start" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.exchangeHour.value == 'period'">-</span>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_end" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="t-f-half t-f-b" ng-if="tabType != 'member'">
                        <span class="t-f-left">交易状态</span>
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.statusObj" placeholder="placeholder.all" options="filterStatus" flexible="true" no-empty></sb-dropdown>
                        </div>
                    </div>
                </div>
            </div>
            <div class="t-f-line" ng-if="tabType === 'agreement'">
                <div class="t-f-left">
                    合同时间
                </div>
                <div class="t-f-right">
                    <div class="t-f-half t-f-s">
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.exchangeHour" placeholder="placeholder.all" options="filterExchangeHour" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_start" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.exchangeHour.value == 'period'">-</span>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_end" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="t-f-half t-f-b">
                        <span class="t-f-left">合同状态</span>
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.statusObj" placeholder="placeholder.all" options="filterStatus" flexible="true"  no-empty></sb-dropdown>
                        </div>
                    </div>
                </div>
            </div>
            <div class="t-f-line" ng-if="tabType === 'longrent'">
                <div class="t-f-left">
                    预约时间
                </div>
                <div class="t-f-right">
                    <div class="t-f-half t-f-s">
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.exchangeHour" placeholder="placeholder.all" options="filterExchangeHour" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_start" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.exchangeHour.value == 'period'">-</span>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_end" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="t-f-half t-f-b">
                        <span class="t-f-left">预约状态</span>
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.statusObj" placeholder="placeholder.all" options="filterStatus" flexible="true" no-empty></sb-dropdown>
                        </div>
                    </div>
                </div>
            </div>
            <div class="t-f-line" ng-if="tabType === 'event'">
                <div class="t-f-left">
                    活动时间
                </div>
                <div class="t-f-right">
                    <div class="t-f-half t-f-s">
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.exchangeHour" placeholder="placeholder.all" options="filterExchangeHour" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_start" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.exchangeHour.value == 'period'">-</span>
                        <div class="date_input" ng-if="filterOption.exchangeHour.value == 'period'">
                            <input type="text" ng-model="filterOption.create_end" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="t-f-half t-f-b">
                        <span class="t-f-left">付款时间</span>
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.payDate" placeholder="placeholder.all" options="filterPayDate" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.payDate.value == 'pay_date'">
                            <input type="text" ng-model="filterOption.pay_date" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <div class="date_input" ng-if="filterOption.payDate.value == 'both' || filterOption.payDate.value == 'pay_start'">
                            <input type="text" ng-model="filterOption.pay_start" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.payDate.value == 'both'">-</span>
                        <div class="date_input" ng-if="filterOption.payDate.value == 'both' || filterOption.payDate.value == 'pay_end'">
                            <input type="text" ng-model="filterOption.pay_end" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="t-f-line" ng-if="tabType == 'space' || tabType == 'longrent' || tabType == 'agreement'">
                <div class="t-f-left">
                    租赁时间
                </div>
                <div class="t-f-right">
                    <div class="t-f-half t-f-s">
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.rentDate" placeholder="placeholder.all" options="filterRentDate" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.rentDate.value">
                            <input type="text" ng-model="filterOption.start_date" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.rentDate.value">-</span>
                        <div class="date_input" ng-if="filterOption.rentDate.value">
                            <input type="text" ng-model="filterOption.end_date" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="t-f-half t-f-b" ng-if="tabType !== 'longrent' && tabType !== 'agreement'">
                        <span class="t-f-left">付款时间</span>
                        <div class="drop-wra">
                            <sb-dropdown select="filterOption.payDate" placeholder="placeholder.all" options="filterPayDate" flexible="true" no-empty></sb-dropdown>
                        </div>
                        <div class="date_input" ng-if="filterOption.payDate.value == 'pay_date'">
                            <input type="text" ng-model="filterOption.pay_date" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <div class="date_input" ng-if="filterOption.payDate.value == 'both' || filterOption.payDate.value == 'pay_start'">
                            <input type="text" ng-model="filterOption.pay_start" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                        <span ng-if="filterOption.payDate.value == 'both'">-</span>
                        <div class="date_input" ng-if="filterOption.payDate.value == 'both' || filterOption.payDate.value == 'pay_end'">
                            <input type="text" ng-model="filterOption.pay_end" data-max-date="{{filterOption.endDate}}" data-date-format="yyyy-MM-dd" data-autoclose="1" bs-datepicker>
                            <span><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="t-btn-wra">
                <div class="t-search-btn" ng-click="searchList()">
                    搜索
                </div>
                <span class="clear-btn" ng-click="clearSearchFilters()">清空</span>
            </div>
        </div>
        <div class="space-bot">
            <div class="space-b-con">
                <div class="s-info-page p25" ng-if="tabType === 'space'">
                    <div class="line-width info-tit" ng-if="spaceList.length > 0">
                        <div class="line-item per32 t-left">
                            空间
                        </div>
                        <div class="line-item per19">
                            单价
                        </div>
                        <div class="line-item per15">
                            租赁/账单时间
                        </div>
                        <div class="line-item per11">
                            付款人
                        </div>
                        <div class="line-item per11">
                            下单方式
                        </div>
                        <div class="line-item per11">
                            操作
                        </div>
                    </div>
                    <div class="space-b-box" ng-repeat="item in spaceList">
                        <div class="b-title tit-top">
                            <span class="blake-txt">订单号：{{item.order_number}}</span>
                            <span class="grey-txt" ng-if="item.sales_invoice && item.pay_channel != 'account'">({{item.product.room.building.company.name}}开票)</span>
                            <span class="grey-txt" ng-if="!item.sales_invoice && item.pay_channel != 'account'">(创合开票)</span>
                            <span class="f-right" ng-bind="item.creation_date | date: 'yyyy-MM-dd'"></span>
                        </div>
                        <div class="line-width">
                            <div class="line-item per32 t-left">
                                <div class="item-con">
                                    <div class="p-w-t">
                                        <div class="p-p">
                                            <img ng-src="{{item.product_info.room.attachment[0].attachment_id.content}}">
                                        </div>
                                        <div class="p-t">
                                            <div class="p-t-top hover" ng-click="seeRoomDetail(item.product_info)">
                                                {{item.product_info.room.city.name}}, {{item.product_info.room.building.name}}, {{item.product_info.room.name}}<span ng-if="item.product_info.room.type == 'fixed'">，座位号{{item.product_info.room.seat.seat_number}}</span>
                                            </div>
                                            <div class="p-t-bot">
                                                <span class="detail-tag red" ng-if="item.product.room.type !== 'longterm'">秒</span>
                                                <span class="detail-tag ora" ng-if="item.product.room.type === 'longterm'">长</span>
                                                <span>{{roomTypeDesc[item.product.room.type].description}}</span>
                                                <div class="for-hover">
                                                    <div class="detail-tag green" ng-if="item.appointed">
                                                        指
                                                        <div class="u-box just-show">
                                                            <img ng-src="{{userOptions[item.appointed].avatar}}" class="u-ava">
                                                            <div class="u-nick">{{userOptions[item.appointed].name}}</div>
                                                            <div class="u-info">
                                                                <span ng-if="userOptions[item.appointed].phone">{{userOptions[item.appointed].phone}}</span>
                                                                <span ng-if="userOptions[item.appointed].email">{{userOptions[item.appointed].email}}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <span ng-if="item.appointed">指定用户</span>
                                                </div>
                                                <div class="detail-tag blue" ng-if="item.invited_people.length > 0">邀</div>
                                                <span ng-if="item.invited_people.length > 0">邀请用户</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per19">
                                <div class="item-con">
                                    <div ng-if="item.product_info.room.type != 'fixed' && item.product_info.base_price">{{::item.product_info.base_price | currency: '￥':2 }}/{{unitDesc[item.product_info.unit_price]}}</div>
                                    <div ng-if="item.product_info.room.type == 'fixed'">{{::item.product_info.base_price | currency: '￥':2 }}/{{unitDesc[item.product_info.unit_price]}}</div>
                                    <div ng-if="item.product_info.room.type_tag != 'dedicated_desk' && !item.product_info.base_price && item.product_info.room.type != 'fixed'" >{{::item.product_info.order.base_price | currency: '￥':2 }}/{{unitDesc[item.product_info.order.unit_price]}}</div>
                                    <div ng-if="item.product_info.room.type_tag == 'dedicated_desk' && !item.product_info.base_price">{{::item.product_info.room.seat.base_price | currency: '￥':2 }}/{{unitDesc[item.product_info.order.unit_price]}}</div>

                                </div>
                            </div>
                            <div class="line-item per15">
                                <div class="item-con">
                                    <span ng-if="item.product_info.unit_price === 'hour'">{{item.start_date | date: 'yyyy-MM-dd'}}<br/>({{item.start_date | date: 'HH:mm'}} - {{item.end_date | date: 'HH:mm'}})</span>
                                    <span ng-if="item.product_info.unit_price !== 'hour'">{{item.start_date | date: 'yyyy-MM-dd'}}<br/>{{'TO' | translate}}<br/>{{item.end_date | date: 'yyyy-MM-dd'}}</span>
                                </div>
                            </div>
                            <div class="line-item per11">
                                <div class="item-con">
                                    <div class="link-txt">
                                        <span class="detail-tag d-ora" ng-if="item.payment_user_id && item.payment_user_id != item.user_id">代</span>
                                        <span ng-if="item.pay_channel != 'offline'">{{::userOptions[item.payment_user_id].name}}</span>
                                        <span ng-if="item.pay_channel == 'offline'">{{::userOptions[item.user_id].name}}</span>
                                        <div class="u-box just-show">
                                            <img ng-src="{{userOptions[item.payment_user_id].avatar}}" class="u-ava">
                                            <div class="u-nick">{{userOptions[item.payment_user_id].name}}</div>
                                            <div class="u-info">
                                                <span ng-if="userOptions[item.user_id].phone">{{userOptions[item.payment_user_id].phone}}</span>
                                                <span ng-if="userOptions[item.user_id].email">{{userOptions[item.payment_user_id].email}}</span>
                                            </div>
                                            <span class="n-icon ic_msg" ng-click="generateChat(item.payment_user_id, item.product.room.building.id)" ng-if="customerservice[item.product.room.building.id]"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per11">
                                <div class="item-con">
                                    <div ng-if="!item.type">{{'SELF_ORDER' | translate}}</div>
                                    <div ng-if="item.type">{{item.type | translate}}</div>
                                    <div ng-if="item.pay_channel"><span class="detail-tag widder t-shadow" ng-class="{'wechat': item.pay_channel == 'wx','account': item.pay_channel == 'account','offline': item.pay_channel == 'offline','alipay': item.pay_channel == 'alipay' || item.pay_channel == 'upacp','we-off': item.pay_channel == 'wx_pub'}">{{item.pay_channel | translate}}</span></div>
                                </div>
                            </div>
                            <div class="line-item per11 last-box">
                                <div class="item-con">
                                    <div class="status">
                                        <span class="status-txt" ng-if="item.status != 'cancelled' && !(item.status == 'unpaid' && item.transfer[0].transfer_status == 'verify')">{{item.status.toUpperCase() | translate}}</span>
                                        <span class="status-txt" ng-if="item.status == 'unpaid' && item.transfer[0].transfer_status == 'verify'">审核中</span>
                                        <span class="status-txt" ng-if="item.status == 'cancelled' && !item.refunded && !item.need_to_refund">已取消</span>
                                        <span class="status-txt" ng-if="item.status == 'cancelled' && item.refunded">已退款</span>
                                        <span class="status-txt" ng-if="item.status == 'cancelled' && item.need_to_refund">待退款</span>
                                        <div class="status-box">
                                            <div class="status-head">
                                                订单历史状态记录
                                            </div>
                                            <div class="status-con">
                                                <div class="status-line" ng-if="item.creation_date">
                                                    <div class="con-left">下单时间:</div>
                                                    <div class="con-right">{{item.creation_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.payment_date">
                                                    <div class="con-left">付款时间:</div>
                                                    <div class="con-right">{{item.payment_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.cancelled_date">
                                                    <div class="con-left">取消时间:</div>
                                                    <div class="con-right">{{item.cancelled_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.refund_processed_date">
                                                    <div class="con-left">退款时间:</div>
                                                    <div class="con-right">{{item.refund_processed_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.end_date && item.status === 'completed'">
                                                    <div class="con-left">订单结束时间:</div>
                                                    <div class="con-right">{{item.end_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="grey" ng-if="item.refunded && item.refund_to === 'account'">(退款到余额)</div>
                                    <div class="grey" ng-if="item.refunded && !item.refund_to">(原路退回)</div>
                                    <div ng-if="item.refunded || item.refund_processed || item.status == 'cancelled' && item.transfer.length > 0 && item.transfer[0].transfer_status == 'paid' || item.status == 'cancelled' && item.pay_channel && item.pay_channel != 'offline'">({{item.discount_price | currency: '￥':2 }})</div>
                                    <div class="link-txt" ng-click="seeOrderDetail(item, 'spaceDetail')">查看详情</div>
                                    <div class="link-txt" ng-if="((item.type === 'reserve' && item.status !== 'cancelled' && item.cancellable) || (item.type === 'preorder' && item.status !== 'cancelled' && item.status !== 'paid' && item.cancellable)) && (currentAdmin.user.is_super_admin || currentAdmin.spaceOrderMap[PERMISSION_SPACE_KEY + item.product.room.building.id] === 2)" ng-click="cancelOrder(item.id)">{{'CANCEL_ORDER' | translate}}</div>
                                    <div class="link-txt" ng-if="item.product_info.room.type === 'office' && (item.status === 'completed' || item.status === 'paid') && item.rejected && (currentAdmin.user.is_super_admin || currentAdmin.spaceOrderMap[PERMISSION_SPACE_KEY + item.product.room.building.id] === 2)" ng-click="setStatus(item.id, false)">同意</div>
                                    <div class="link-txt" ng-if="item.product_info.room.type === 'office' && (item.status === 'completed' || item.status === 'paid') && item.rejected && (currentAdmin.user.is_super_admin || currentAdmin.spaceOrderMap[PERMISSION_SPACE_KEY + item.product.room.building.id] === 2)" ng-click="setStatus(item.id, true)">拒绝</div>
                                </div>
                            </div>
                        </div>
                        <div class="b-title tit-bot">
                            <span class="link-txt f-right" ng-if="item.status === 'unpaid' && (currentAdmin.spaceOrderMap[PERMISSION_SPACE_KEY + item.product.room.building.id] === 2 || currentAdmin.user.is_super_admin)" ng-click="seePopup('orderAmount', item)">更改</span>
                            <span class="del-txt f-right" ng-if="item.price != item.discount_price">({{item.price | currency: '￥':2 }})</span>
                            <span class="blake-txt f-right" ng-if="item.status != 'paid' && item.status != 'completed' &&  !item.refund_processed && !item.need_to_refund && !item.refunded && item.transfer.length == 0 || item.status == 'unpaid' && item.transfer[0].transfer_status == 'pending'">应付款: {{::item.discount_price | currency: '￥':2 }}</span>
                            <span class="blake-txt f-right" ng-if="item.status == 'paid' || item.status == 'completed' || item.refund_processed || item.need_to_refund || item.refunded || item.status == 'unpaid' && item.transfer[0].transfer_status == 'verify' || item.status == 'cancelled' && item.transfer[0].transfer_status == 'returned'">实付款: {{::item.discount_price | currency: '￥':2 }}</span>
                        </div>
                    </div>
                    <div class="nodata" ng-if="spaceList.length <= 0 && loaded">无空间订单</div>
                </div>
                <div class="s-info-page p25" ng-if="tabType === 'agreement'">
                    <div class="line-width info-tit" ng-if="leasesList.length > 0">
                        <div class="line-item per32 t-left">
                            空间
                        </div>
                        <div class="line-item per19 t-left">
                            承租方
                        </div>
                        <div class="line-item per19">
                            租用时间段
                        </div>
                        <div class="line-item per9_5">
                            合同账单
                        </div>
                        <div class="line-item per9_5">
                            其他账单
                        </div>
                        <div class="line-item per11">
                            操作
                        </div>
                    </div>
                    <div class="space-b-box" ng-repeat="item in leasesList">
                        <div class="b-title tit-top">
                            <span class="blake-txt">合同号：{{item.serial_number}}</span>
                            <span class="f-right">{{item.confirming_date | date: 'yyyy-MM-dd'}}</span>
                        </div>
                        <div class="line-width">
                            <div class="line-item per32 t-left">
                                <div class="item-con">
                                    <div class="p-w-t">
                                        <div class="p-p">
                                            <img ng-src="{{item.product.room.attachment}}">
                                        </div>
                                        <div class="p-t">
                                            <div class="p-t-top hover" ng-click="seeRoomDetail(item.product)">
                                                {{item.product.room.city}}, {{item.product.room.building.name}}, {{item.product.room.name}}
                                            </div>
                                            <div class="p-t-bot">
                                                <span class="detail-tag red" ng-if="item.product.room.type !== 'longterm'">秒</span>
                                                <span class="detail-tag ora" ng-if="item.product.room.type === 'longterm'">长</span>
                                                <span>{{roomTypeDesc[item.product.room.type].description}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per19 t-left">
                                <div class="item-con">
                                    <div ng-bind="item.lessee_name"></div>
                                    <div class="link-txt" ng-bind="item.lessee_email"></div>
                                    <div class="link-txt" ng-bind="item.lessee_phone"></div>
                                </div>
                            </div>
                            <div class="line-item per19">
                                <div class="item-con">
                                    <div>{{item.start_date | date: 'yyyy-MM-dd'}}</div>
                                    <div>-</div>
                                    <div>{{item.end_date | date: 'yyyy-MM-dd'}}</div>
                                </div>
                            </div>
                            <div class="line-item per9_5">
                                <div class="item-con">
                                    <div><span class="link-txt">{{item.pushed_lease_bills_amount}}</span> / <span class="link-txt">{{item.total_lease_bills_amount}}</span></div>
                                </div>
                            </div>
                            <div class="line-item per9_5">
                                <div class="item-con">
                                    <div><span class="link-txt">{{item.other_bills_amount}}</span></div>
                                </div>
                            </div>
                            <div class="line-item per11">
                                <div class="item-con">
                                    <div class="status">
                                        <span class="status-txt">{{agreementStatus[item.status]}}</span>
                                        <div class="status-box">
                                            <div class="status-head">
                                                合同历史状态记录
                                            </div>
                                            <div class="status-con">
                                                <div class="status-line" ng-if="item.change_logs.apply_date">
                                                    <div class="con-left">预约时间:</div>
                                                    <div class="con-right">{{item.change_logs.apply_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.change_logs.lease_conforming_date">
                                                    <div class="con-left">合同生成时间:</div>
                                                    <div class="con-right">{{item.change_logs.lease_conforming_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.change_logs.lease_conformed_date">
                                                    <div class="con-left">确认时间:</div>
                                                    <div class="con-right">{{item.change_logs.lease_conformed_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.change_logs.lease_performing_date">
                                                    <div class="con-left">生效时间:</div>
                                                    <div class="con-right">{{item.change_logs.lease_performing_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.change_logs.lease_close_date && item.status == 'closed'">
                                                    <div class="con-left">关闭时间:</div>
                                                    <div class="con-right">{{item.change_logs.lease_close_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.change_logs.lease_close_date && item.status == 'terminated'">
                                                    <div class="con-left">终止时间:</div>
                                                    <div class="con-right">{{item.change_logs.lease_close_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.status === 'matured'">
                                                    <div class="con-left">到期时间:</div>
                                                    <div class="con-right">{{item.end_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="link-txt" ng-click="seeContractDetail(item.id)">查看详情</div>
                                </div>
                            </div>
                        </div>
                        <div class="b-title tit-bot">
                            <span class="blake-txt">合同负责人:</span>
                            <div class="blake-txt link-txt">
                                {{userOptions[item.supervisor].name}}
                                <div class="u-box just-show">
                                    <img ng-src="{{userOptions[item.supervisor].avatar}}" class="u-ava">
                                    <div class="u-nick">{{userOptions[item.supervisor].name}}</div>
                                    <div class="u-info">
                                        <span ng-if="userOptions[item.supervisor].phone">{{userOptions[item.supervisor].phone}}</span>
                                        <span ng-if="userOptions[item.supervisor].email">{{userOptions[item.supervisor].email}}</span>
                                    </div>
                                    <span class="n-icon ic_msg" ng-if="customerservice[item.product.room.building.id]" ng-click="generateChat(item.supervisor, item.product.room.building.id)"></span>
                                </div>
                            </div>
                            <span class="blake-txt f-right">已出账单总金额: {{item.pushed_lease_bills_fees}} 元</span>
                        </div>
                    </div>
                    <div class="nodata" ng-if="leasesList.length <= 0 && loaded">无长租合同</div>
                </div>
                <div class="s-info-page p25" ng-if="tabType === 'longrent'">
                    <div class="line-width info-tit" ng-if="appointmentList.length > 0">
                        <div class="line-item per32 t-left">空间</div>
                        <div class="line-item per19 t-left">承租方</div>
                        <div class="line-item per19">起租日</div>
                        <div class="line-item per9_5">月数</div>
                        <div class="line-item per9_5">租金</div>
                        <div class="line-item per11">操作</div>
                    </div>
                    <div class="space-b-box" ng-repeat="item in appointmentList">
                        <div class="b-title tit-top">
                            <span class="blake-txt">预约号：{{item.appointment_number}}</span>
                            <span class="f-right">{{item.creation_date | date: 'yyyy-MM-dd'}}</span>
                        </div>
                        <div class="line-width">
                            <div class="line-item per32 t-left">
                                <div class="item-con">
                                    <div class="p-w-t">
                                        <div class="p-p">
                                            <img ng-src="{{item.product.room.attachment[0].attachment_id.content}}">
                                        </div>
                                        <div class="p-t">
                                            <div class="p-t-top hover" ng-click="seeRoomDetail(item.product)">
                                                {{item.product.room.building.name}}, {{item.product.room.name}}
                                            </div>
                                            <div class="p-t-bot">
                                                <span class="detail-tag red" ng-if="item.product.room.type !== 'longterm'">秒</span>
                                                <span class="detail-tag ora" ng-if="item.product.room.type === 'longterm'">长</span>
                                                <span>{{roomTypeDesc[item.product.room.type].description}}</span>
                                                <span class="detail-tag green" ng-if="item.appointed">指</span>
                                                <span ng-if="item.appointed" ng-bind="userOptions[item.appointed].name"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per19 t-left">
                                <div class="item-con">
                                    <div ng-bind="item.applicant_company"></div>
                                    <div class="link-txt" ng-bind="item.applicant_email"></div>
                                    <div class="link-txt" ng-bind="item.applicant_phone"></div>
                                </div>
                            </div>
                            <div class="line-item per19">
                                <div class="item-con">
                                    <div>{{item.start_rent_date | date: 'yyyy-MM-dd'}}</div>
                                </div>
                            </div>
                            <div class="line-item per9_5">
                                <div class="item-con">
                                    <div ng-bind="item.rent_time_length"></div>
                                </div>
                            </div>
                            <div class="line-item per9_5">
                                <div class="item-con">
                                    <div>{{::item.product.rent_set.base_price}}元/{{unitDesc[item.product.unit_price]}}起</div>
                                </div>
                            </div>
                            <div class="line-item per11 last-box">
                                <div class="item-con">
                                    <div class="status">
                                        <span class="status-txt" ng-bind="appointmentOrderStatus[item.status]"></span>
                                        <div class="status-box">
                                            <div class="status-head">
                                                预约申请历史状态记录
                                            </div>
                                            <div class="status-con">
                                                <div class="status-line">
                                                    <div class="con-left">申请时间:</div>
                                                    <div class="con-right">{{item.creation_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line" ng-if="item.status !== 'pending'">
                                                    <div class="con-left" ng-if="item.status === 'accepted'">同意时间:</div>
                                                    <div class="con-left" ng-if="item.status === 'rejected'">拒绝时间:</div>
                                                    <div class="con-left" ng-if="item.status === 'withdrawn'">撤销时间:</div>
                                                    <div class="con-right">{{item.modification_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="link-txt" ng-click="generateAgreement(item)" ng-if="!item.lease_id && item.status === 'pending' && (currentAdmin.user.is_super_admin || (currentAdmin.leasesMap[PERMISSION_LEASES_KEY + item.product.room.building.id] === 2 && currentAdmin.appointmentMap[PERMISSION_APPOINTMENT_KEY + item.product.room.building.id] === 2))">生成合同</div>
                                    <div class="link-txt" ng-click="seeUpdateDraft(item.lease_id)" ng-if="item.lease_id && item.status === 'pending' && (currentAdmin.user.is_super_admin || currentAdmin.leasesMap[PERMISSION_LEASES_KEY + item.product.room.building.id] === 2) ">继续编辑合同</div>
                                    <div class="link-txt" ng-click="seeContractDetail(item.lease_id)" ng-if="item.lease_id && item.status === 'accepted' && (currentAdmin.user.is_super_admin || currentAdmin.leasesMap[PERMISSION_LEASES_KEY + item.product.room.building.id]) ">查看合同</div>
                                    <div class="link-txt" ng-click="showRejectedConfirm(item)" ng-if="item.status === 'pending' && (currentAdmin.user.is_super_admin || currentAdmin.appointmentMap[PERMISSION_APPOINTMENT_KEY + item.product.room.building.id] === 2)">拒绝</div>
                                </div>
                            </div>
                        </div>
                        <div class="b-title tit-bot">
                            <span class="blake-txt">预约人:</span>
                            <div class="blake-txt link-txt">
                                {{userOptions[item.user_id].name}}
                                <div class="u-box just-show">
                                    <img ng-src="{{userOptions[item.user_id].avatar}}" class="u-ava">
                                    <div class="u-nick">{{userOptions[item.user_id].name}}</div>
                                    <div class="u-info">
                                        <span ng-if="userOptions[item.user_id].phone">{{userOptions[item.user_id].phone}}</span>
                                        <span ng-if="userOptions[item.user_id].email">{{userOptions[item.user_id].email}}</span>
                                    </div>
                                    <span class="n-icon ic_msg" ng-if="customerservice[item.product.room.building.id]" ng-click="generateChat(item.user_id, item.product.room.building.id)"></span>
                                </div>
                            </div>
                            <span class="blake-txt f-right">预约总租金: {{::item.product.rent_set.base_price * item.rent_time_length}} 元起</span>
                        </div>
                    </div>
                    <div class="nodata" ng-if="appointmentList.length <= 0 && loaded">无长租申请</div>
                </div>
                <div class="s-info-page p25" ng-if="tabType === 'event'">
                    <div class="line-width info-tit" ng-if="eventList.length > 0">
                        <div class="line-item per32 t-left">
                            活动
                        </div>
                        <div class="line-item per19">
                            活动时间
                        </div>
                        <div class="line-item per19">
                            活动地点
                        </div>
                        <div class="line-item per9_5">
                            发起公司
                        </div>
                        <div class="line-item per9_5">
                            购买者
                        </div>
                        <div class="line-item per11">
                            操作
                        </div>
                    </div>
                    <div class="space-b-box" ng-repeat="item in eventList">
                        <div class="b-title tit-top">
                            <span class="blake-txt">订单号：{{item.order_number}}</span>
                            <span class="f-right" ng-bind="item.creation_date | date: 'yyyy-MM-dd'"></span>
                        </div>
                        <div class="line-width">
                            <div class="line-item per32 t-left">
                                <div class="item-con">
                                    <div class="p-w-t">
                                        <div class="p-p">
                                            <img ng-src="{{item.event.attachments[0].content}}">
                                        </div>
                                        <div class="p-t">
                                            <div class="p-t-top black hover" ng-click="seeEventDetail(item)">
                                                {{item.event.name}}
                                            </div>
                                            <div class="p-t-bot grey" trigger='hover' data-placement="bottom-left" data-content-template="js/features/transaction/partials/popover.html" data-auto-close="1" bs-popover>
                                                <div class="text-con">{{item.event.description}}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per19">
                                <div class="item-con">
                                    <div trigger='hover' data-placement="bottom-left" data-content-template="js/features/transaction/partials/descPopover.html" data-auto-close="1" bs-popover>
                                        <div>{{item.minDate | date: 'yyyy-MM-dd'}}</div>
                                        <div ng-if="item.minDate != item.maxDate">-</div>
                                        <div ng-if="item.minDate != item.maxDate">{{item.maxDate | date: 'yyyy-MM-dd'}}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per19">
                                <div class="item-con">
                                    <div>{{item.event.address}}</div>
                                </div>
                            </div>
                            <div class="line-item per9_5">
                                <div class="item-con">
                                    <div>{{item.event.publish_company}}</div>
                                </div>
                            </div>
                            <div class="line-item per9_5">
                                <div class="item-con">
                                    <div>{{userOptions[item.user_id].name}}</div>
                                </div>
                            </div>
                            <div class="line-item per11 last-box">
                                <div class="item-con">
                                    <div class="status">
                                        <span class="status-txt">{{item.status.toUpperCase() | translate}}</span>
                                        <div class="status-box">
                                            <div class="status-head">
                                                订单历史状态记录
                                            </div>
                                            <div class="status-con">
                                                <div class="status-line">
                                                    <div class="con-left">下单时间:</div>
                                                    <div class="con-right">{{item.creation_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line">
                                                    <div class="con-left">付款时间:</div>
                                                    <div class="con-right">{{item.payment_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="link-txt" ng-click="seeOrderDetail(item, 'eventDetail')">查看详情</div>
                                </div>
                            </div>
                        </div>
                        <div class="b-title tit-bot">
                            <span class="blake-txt f-right">实付款: {{::item.price | currency: '￥':2 }}</span>
                            <div class="detail-tag f-right" ng-class="{account: item.pay_channel == 'account',blue: item.pay_channel == 'alipay',green: item.pay_channel == 'wx'}">{{item.pay_channel | translate}}</div>
                        </div>
                    </div>
                    <div class="nodata" ng-if="eventList.length <= 0 && loaded">无活动订单</div>
                </div>
                <div class="s-info-page p25" ng-if="tabType === 'member'">
                    <div class="line-width info-tit">
                        <div class="line-item per40 t-left">
                            会员卡
                        </div>
                        <div class="line-item per15">
                            单价
                        </div>
                        <div class="line-item per15">
                            有效期
                        </div>
                        <div class="line-item per15">
                            购买者
                        </div>
                        <div class="line-item per15">
                            操作
                        </div>
                    </div>
                    <div class="space-b-box" ng-repeat="item in membershipList">
                        <div class="b-title tit-top">
                            <span class="blake-txt">订单号：{{item.order_number}}</span>
                            <span class="f-right" ng-bind="item.creation_date | date: 'yyyy-MM-dd'"></span>
                        </div>
                        <div class="line-width">
                            <div class="line-item per40 t-left">
                                <div class="item-con">
                                    <div class="p-w-t">
                                        <div class="p-p">
                                            <img ng-src="{{item.card.background}}">
                                        </div>
                                        <div class="p-t">
                                            <div class="p-t-top black hover" ng-click="seeOrderDetail(item, 'memberDetail')">
                                                {{item.card.name}}
                                            </div>
                                            <div class="p-t-bot grey">
                                                <div class="text-con">{{item.specification}}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per15">
                                <div class="item-con">
                                    <div>
                                        <div>{{item.price}}元</div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per15">
                                <div class="item-con">
                                    <div>{{item.valid_period}}个月</div>
                                </div>
                            </div>
                            <div class="line-item per15">
                                <div class="item-con">
                                    <div class="link-txt">
                                        {{::userOptions[item.user].name}}
                                        <div class="u-box just-show">
                                            <img ng-src="{{userOptions[item.user].avatar}}" class="u-ava">
                                            <div class="u-nick">{{userOptions[item.user].name}}</div>
                                            <div class="u-info">
                                                <span ng-if="userOptions[item.user].phone">{{userOptions[item.user].phone}}</span>
                                                <span ng-if="userOptions[item.user].email">{{userOptions[item.user].email}}</span>
                                            </div>
                                            <span class="n-icon ic_msg" ng-click="generateChat(item.user, item.product.room.building.id)" ng-if="customerservice[item.product.room.building.id]"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="line-item per15 last-box">
                                <div class="item-con">
                                    <div class="status">
                                        <span class="status-txt">已完成</span>
                                        <div class="status-box">
                                            <div class="status-head">
                                                订单历史状态记录
                                            </div>
                                            <div class="status-con">
                                                <div class="status-line">
                                                    <div class="con-left">创建时间:</div>
                                                    <div class="con-right">{{item.creation_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                                <div class="status-line">
                                                    <div class="con-left">付款时间:</div>
                                                    <div class="con-right">{{item.payment_date | date: 'yyyy-MM-dd HH:mm:ss'}}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="link-txt" ng-click="seeOrderDetail(item, 'memberDetail')">查看详情</div>
                                </div>
                            </div>
                        </div>
                        <div class="b-title tit-bot">
                            <span class="blake-txt f-right">实付款: {{::item.price | currency: '￥':2 }}</span>
                            <div class="detail-tag f-right" ng-class="{account: item.pay_channel == 'account',blue: item.pay_channel == 'alipay' || item.pay_channel == 'upacp',green: item.pay_channel == 'wx'}">{{item.pay_channel | translate}}</div>
                        </div>
                    </div>
                    <div class="nodata" ng-if="membershipList.length <= 0 && loaded">无会员卡订单</div>
                </div>
                <pagination option="pageOptions" on-page="goPage(index)"></pagination>
            </div>
        </div>
    </div>
</div>
<ng-include src="'/js/features/transaction/partials/space-order-detail.html'" ng-if="pageType == 'spaceDetail'"></ng-include>
<ng-include src="'/js/features/transaction/partials/event-order-detail.html'" ng-if="pageType == 'eventDetail'"></ng-include>
<ng-include src="'/js/features/transaction/partials/contractDetail.html'" ng-if="pageType == 'contractDetail'"></ng-include>
<ng-include src="'/js/features/transaction/partials/agreement.html'" ng-if="pageType == 'updateAgreement' || pageType == 'updateDraft' || pageType == 'createAgreement'"></ng-include>
<ng-include src="'/js/features/transaction/partials/agreementDrafts.html'" ng-if="pageType == 'drafts'"></ng-include>
<ng-include src="'/js/features/transaction/partials/contract-history.html'" ng-if="pageType == 'history'"></ng-include>
<ng-include src="'/js/features/transaction/partials/billDetail.html'" ng-if="pageType == 'billDetail'"></ng-include>
<ng-include src="'/js/features/transaction/partials/order-page.html'" ng-if="pageType == 'orderPage'"></ng-include>
<ng-include src="'/js/features/transaction/partials/memberShip.html'" ng-if="pageType == 'memberDetail'"></ng-include>
